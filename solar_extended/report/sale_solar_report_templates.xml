<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="report_saleorder_document_solar">
  <t t-call="web.external_layout">
    <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
        <t t-set="address">
          <!-- Show Contact name-->
          <div t-field="doc.contact_person.name"/>
          <div t-field="doc.contact_person" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True}"/>
            <p t-if="doc.contact_person.vat"><t t-esc="doc.company_id.country_id.vat_label or 'Tax ID'"/>: <span t-field="doc.contact_person.vat"/></p>
        </t>
            <t t-set="information_block">

              <!-- Display address is depending on vat reduction type -->
              <!-- We tried several things it seems this is the best solid solution -->

              <!-- Variables -->
              <!-- ****************************************************************************************************** -->
              <!--
              <t t-set="invoice_address" t-value="doc.partner_invoice_id"/>
              <t t-set="delivery_address" t-value="doc.partner_shipping_id"/>
              <t t-set="show_invoice_address" t-value="True"/>
              <t t-set="show_delivery_address" t-value="True"/>
              -->


              <!-- THE LOGIC -->
              <!-- ****************************************************************************************************** -->
              <t t-if="doc.vat_reduction_type == 'yes'">
                <!-- We assume when the reduction is there that the customer is a privated persoon and therefor want to see his personal details -->
                <t t-set="invoice_address" t-value="doc.contact_person"/>
                <t t-set="delivery_address" t-value="doc.contact_person"/>

                <t t-set="show_invoice_address" t-value="False"/>
                <t t-set="show_delivery_address" t-value="False"/>  
              </t>

              <t t-elif="doc.vat_reduction_type == 'no'">
                <!-- Special cases like VVE's etc and similiar to business -->
                <t t-set="invoice_address" t-value="doc.contact_person"/>
                <t t-set="delivery_address" t-value="doc.contact_person"/>
                <t t-set="show_invoice_address" t-value="True"/>
                <t t-set="show_delivery_address" t-value="True"/>  
              </t>

              <t t-elif="doc.vat_reduction_type == 'business'">
                <!-- We assume when the reduction is there that the customer is a business and therefor a more pragmatic display is wished -->
                <t t-set="invoice_address" t-value="doc.contact_person"/>
                <t t-set="delivery_address" t-value="doc.contact_person"/>
                <t t-set="show_invoice_address" t-value="True"/>
                <t t-set="show_delivery_address" t-value="True"/>  
              </t>

              <t t-else="">
                <t t-set="invoice_address" t-value="doc.partner_invoice_id"/>
                <t t-set="delivery_address" t-value="doc.partner_shipping_id"/>
                <t t-set="show_invoice_address" t-value="True"/>
                <t t-set="show_delivery_address" t-value="True"/>  
              </t>
              


              <!-- THE EXECUTION OF THE LOGIC -->
              <!-- ****************************************************************************************************** -->
              <t t-if="show_invoice_address">
                <strong>Factuur adres:</strong>
                <div t-field="invoice_address.name"/>
                <div t-esc="invoice_address" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
              </t>

              <t t-if="show_delivery_address">
                <strong>Installatie adres:</strong>
                <div t-field="delivery_address.name"/>
                <div t-esc="delivery_address" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True}"/>
              </t>
            </t>


        <div class="page" style="font-size: 14px !important;">
          <!-- INSIDE CSS-->
          <style type="text/css">
            <![CDATA[
            .pebble_header {
                  font-size: 22px;
              }
            .pebble_tittle {
                  font-size: 22px;
              }
              ]]>
          </style>




            <div class="oe_structure"/>
            <h2 class="pebble_tittle">
                <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                    <span t-if="doc.state not in ['draft','sent']">Verkooporder # </span>
                    <span t-if="doc.state in ['draft','sent']">Offerte # </span>
                </t>
                <t t-if="env.context.get('proforma', False) or is_pro_forma">
                    <span>Pro-Forma factuur # </span>
                </t>
                <span t-field="doc.name"/>
            </h2>

            <div class="row mt-2 mb-2" id="informations">
                <div t-if="doc.client_order_ref" class="col-auto col-3 mw-100 mb-2" name="informations_reference">
                    <strong>Referentie:</strong>
                    <p class="m-0" t-field="doc.client_order_ref"/>
                </div>
                <div t-if="doc.date_order and doc.state not in ['draft','sent']" class="col-auto col-3 mw-100 mb-2" name="informations_date">
                    <strong>Order datum:</strong>
                    <p class="m-0" t-field="doc.date_order" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                </div>
                <div t-if="doc.date_order and doc.state in ['draft','sent']" class="col-auto col-3 mw-100 mb-2">
                    <strong>Offere datum:</strong>
                    <p class="m-0" t-field="doc.date_order" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                </div>
                <div t-if="doc.validity_date and doc.state in ['draft', 'sent']" class="col-auto col-3 mw-100 mb-2" name="expiration_date">
                    <strong>Vervaldatum:</strong>
                    <p class="m-0" t-field="doc.validity_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                </div>
                <div t-if="doc.user_id.name" class="col-2">
                    <strong>Verkoper:</strong><br/>
                    <span t-field="doc.user_id"/><br/>
                    <span t-field="doc.user_id.mobile"/>
                </div>
            </div>

            <!-- Loop the photos and obstacles and the set it to true, then show the this part. -->
            <!-- When no pictures then do not print the below part-->
            <div>
              <div class="pebble_header p-1" style="border-bottom: 1px solid black;">
                <b>Beschikbare dakoppervlak(ken)</b>
              </div>
              <!-- Show only the roofs that have the checkbox printed on true-->
              <div style="page-break-inside:avoid;">
                <t t-foreach="doc.roofdata_line_ids" t-as="line">
                  <div class="row" t-if="line.is_printed == True">
                    <div class="col-3 text-left">
                      <span class="p-1"> Omschrijving: </span><br/>
                      <span class="p-1"> Dak type: </span><br/>
                      <span class="p-1"> Dak afmetingen: </span><br/>
                      <span class="p-1"> Kompasrichting: </span><br/>
                      <span class="p-1"> Hellingsgraad: </span><br/>
                      <span class="p-1"> Dakbedekking:  </span><br/>
                      <span class="p-1"> Goothoogte: </span><br/>
                    </div>
                    <div class="col-3 text-left">
                      <span class="p-1" t-field="line.description"/><br/>
                      <span class="p-1" t-field="line.rooftype"/><br/>
                      <span class="p-1">L <span t-field="line.roof_length"/> x B <span t-field="line.roof_width"/> mtr </span><br/>
                      <span class="p-1" t-field="line.compass_id"/><br/>
                      <span class="p-1" t-field="line.roofslope_id"/><br/>
                      <span class="p-1" t-field="line.roofcover"/><br/>
                      <span class="p-1" t-field="line.roofheight"/> mtr<br/>
                    </div>
                    <div class="col-6 text-left">
                      <img t-if="line.photo_1" t-att-src="image_data_uri(line.photo_1)" style="max-width: 500px;"/>
                    </div>
                  </div>
                </t>
              </div>
              <!-- Show only the obstacles that have the checkbox printed on true-->
              <br/>
              <div style="page-break-inside:avoid;">
                <t t-foreach="doc.obstacles_line_ids" t-as="line">
                  <div class="row mt-4 mb-4" t-if="line.is_printed == True">
                    <div class="col-6 text-left">
                      <span t-field="line.description"/><br/>
                    </div>
                    <div class="col-6 text-left">
                      <img t-if="line.photo" t-att-src="image_data_uri(line.photo)" style="max-width: 500px;"/>
                    </div>
                  </div>
                </t>
              </div>

              <div style="page-break-inside:avoid;">
                <div class="pebble_header p-1" style="border-bottom: 1px solid black;">
                  <b>Verbruiksgegevens (op jaarbasis)</b>
                </div>
                <div class="row mt-2 mb-2">
                  <div class="col-4 text-left">
                    <span class="p-1"> Energieverbruik </span><br/>
                    <span class="p-1"> Gewenste Productie </span><br/>
                    <span class="p-1"> Huidige Electraprijs </span><br/>
                  </div>
                  <div class="col-2 text-left">
                    <span class="p-1"> ca. </span><br/>
                    <span class="p-1"> ca. </span><br/>
                    <span class="p-1"> ca. </span><br/>
                  </div>
                  <div class="col-6 text-left">
                    <span class="p-1"><span t-esc="'%.0f'% doc.powercon"/>  kWh</span><br/>
                    <span class="p-1"><span t-esc="'%.0f'% doc.desireprod"/> kWh</span><br/>
                    <span class="p-1"><span t-field="doc.energycost"/> Per kWh</span><br/>
                  </div>
                </div>
                <div class="pebble_header p-1" style="border-bottom: 1px solid black;">
                  <b>Prognose van het systeem (op jaarbasis)</b>
                </div>
                <div class="row mt-2 mb-2">
                  <div class="col-4 text-left">
                    <span class="p-1"> CO₂ reductie </span><br/>
                    <span class="p-1"> Verwachtte opbrengst </span><br/>
                    <span class="p-1"> Financiële besparing </span><br/>
                  </div>
                  <div class="col-2 text-left">
                    <span class="p-1"/><br/>
                    <span class="p-1"> ca. </span><br/>
                    <span class="p-1"> ca. </span><br/>
                  </div>
                  <div class="col-6 p-1 text-left">
                    <span class="p-1"><span t-esc="'%.0f'% doc.co2reduction"/> kg </span><br/>
                    <span class="p-1"><span t-esc="'%.0f'% doc.elecprod"/> kWh </span><br/>
                    <span class="p-1" t-field="doc.savings"/><br/>
                  </div>
                </div>
              </div>
            </div>


            <!-- Hard page-break --> 
            <div style="page-break-after:always;"/>

            <t t-if="doc.plan">
	            <div style="page-break-inside:avoid;">
	              <!-- legplan -->
	              <div class="pebble_header p-1" style="border-bottom: 1px solid black;">
	                <b>Legplan</b>
	              </div>
	              <div class="row mt-4 mb-4">
	                <div class="col-12  text-center">
                    <!-- The wish is to make the legplan an pagin big picture-->
	                   <img t-if="doc.plan" t-att-src="image_data_uri(doc.plan)" style="max-height: 1500px; max-width: 1000px;"/>
	                </div>
	              </div>
	            </div>
              <!-- Hard page-break --> 
              <div style="page-break-after:always;"/>
        	  </t>


          <!-- TODO What to do with this part ???? -->
            <!-- Make it connected to the res.company-->
            <t t-if="doc.company_id.b2c_text">
              <div style="page-break-inside:avoid;">
                <div class="row mt-4 mb-4">
                  <div class="col-12">
                    <span t-if="doc.company_id.b2c_text" t-raw="doc.company_id.b2c_text"/>
                    <br/>
                  </div>
                </div>
              </div>
              <br/>
              <!-- Hard page-break --> 
              <div style="page-break-after:always;"/>
            </t>
            
            

            <div style="page-break-inside:avoid;">
              <div style="border-bottom: 1px solid black;"/>
              <div class="row mt-1 mb-1">
                  <div class="col-9 text-left pebble_header">
                        <span >Product</span>
                    </div>
                    <div class="col-3 text-right pebble_header">
                        <span >Aantal</span>
                    </div>
                </div>

                <!-- display every sale order line-->
                <t t-foreach="doc.order_line" t-as="line">
                  <t t-if="not line.display_type">
                    <div style="page-break-inside:avoid;">
                      <t t-if="line.product_id.show_in_b2c == True">
                        <div style="border-bottom: 1px solid grey;"/>
                        <!-- display the name, qty and uom-->
                          <div class="row mt-4 mb-4">
                          <div class="col-9 text-left">
                              <span t-field="line.name"/>
                            </div>
                            <div class="col-3 text-right">
                              <span t-field="line.product_uom_qty" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 0}"/>
                                <span t-field="line.product_uom"/>
                            </div>
                          </div>

                          <!-- Additional information pulled from the product-->
                            <div style="border-bottom: 1px solid grey;"/>
                            <!-- 1 row, 2 columns -->
                            <div class="row mt-4 mb-4">
                          <div class="col-9 text-left">
                              <span t-if="line.product_id.html_product_details" t-raw="line.product_id.html_product_details"/>
                            </div>
                            <div class="col-3 text-right">
                                <img t-if="line.product_id.image_1920" t-att-src="image_data_uri(line.product_id.image_1920)" style="max-height: 150px;"/>
                            </div>
                        </div>
                        <!-- 1 row, 1 column-->
                        <div class="row">
                            <div class="col-12">
                              <span t-if="line.product_id.html_product_details_2" t-raw="line.product_id.html_product_details_2"/>
                              <br/>
                            </div>
                            </div>
                      </t>

                      <t t-if="line.product_id.show_in_b2c != True">
                        <!--<div style="border-bottom: 1px solid grey;"/>-->
                        <!-- display the name, qty and uom-->
                          <div class="row mt-4 mb-4">
                          <div class="col-9 text-left">
                              <span t-field="line.name"/>
                            </div>
                            <div class="col-3 text-right">
                              <span t-field="line.product_uom_qty" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 0}"/>
                                <span t-field="line.product_uom"/>
                            </div>
                          </div>
                      </t>

                    </div>
                  </t>
              </t>
              <!-- end of sale order line display -->
          </div>
          
          <!-- PAGE BREAK -->
          <div style="page-break-after:always;"/>
          <div style="page-break-inside:avoid;">
              <!-- Sales order condition-->
              <div class="row mt8 mb8">
                  <div class="col-12 text-left pebble_header"> 
                      <span ><b>Leveringsconditie's:</b></span>
                  </div>
              </div>
              <div style="border-bottom: 1px solid grey;"/>
              <!--<span t-raw="doc.x_studio_leveringscondities.x_studio_details"/>-->
              <span t-if="doc.html_sale_conditions" t-field="doc.html_sale_conditions"/>
          </div>

          <div style="page-break-inside:avoid;">
            <div class="row mt-4 mb4">
                  <div class="col-12 text-left pebble_header">
                      <span ><b>Betalingsconditie's:</b></span>
                  </div>
              </div>
            <div style="border-bottom: 1px solid grey;"/>
            <!-- Payment Term -->
            <p t-if="doc.payment_term_id.note and sum(line.product_uom_qty for line in doc.order_line) != 0">
                <span t-field="doc.payment_term_id.note"/>
            </p>
          </div>

        <!-- PAGE BREAK -->
        <div style="page-break-after:always;"/>
            <div style="page-break-inside:avoid;">
              <br/>
              <div class="clearfix" name="so_total_summary">
                  <div class="pebble_header" style="border-bottom: 1px solid black;">
            <span><b>Investeringsoverzicht voor <span t-field="doc.name"/></b></span>
          </div>

          <div id="total" class="row" name="total">
            <div t-attf-class="#{'col-8' if report_type != 'html' else 'col-sm-7 col-md-6'} ms-auto">
              <!-- <table class="table table-sm"> -->
              <table class="table-sm table-borderless" style="width: 100%;">
                    <!--<tr class="border-black o_subtotal" style="">-->

                    <tr>
                        <!-- SUBTOTAL -->
                        <td name="td_amount_untaxed_label">Bedrag excl. BTW</td>
                        <td name="td_amount_untaxed" class="text-right">
                          <span t-field="doc.amount_untaxed"/>
                        </td>
                    </tr>

                  <!-- VAT OVERVIEW  
                    <t t-foreach="doc.amount_by_group" t-as="amount_by_group">
                      <tr style="">
                        <t t-if="amount_by_group[3] == 1 and doc.amount_untaxed == amount_by_group[2]">
                              <td name="td_amount_by_group_label_3">
                                <span t-esc="amount_by_group[0]"/>
                                <span>&amp;nbsp;<span>op</span>&amp;nbsp;<t t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></span>
                            </td>
                              <td name="td_amount_by_group_3" class="text-right o_price_total">
                                <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
                              </td>
                        </t>
                        <t t-else="">
                              <td name="td_amount_by_group_label">
                                <span t-esc="amount_by_group[0]"/>
                            </td>
                          <td name="td_amount_by_group" class="text-right o_price_total">
                              <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
                            </td>
                        </t>
                      </tr>
                    </t>-->

                    <!--GRAND TOTAL -->
                    <tr class="border-black o_total">
                      <td name="td_amount_total_label"><strong>Totaal te betalen</strong></td>
                      <td name="td_amount_total" class="text-right">
                          <span t-field="doc.amount_total"/>
                        </td>
                    </tr>


                    <t t-if="doc.vat_reduction_type == 'yes'">
                      <tr>
                        <td/>
                        <td/>
                      </tr>

                      <tr>
                          <!-- Forfair bedrag -->
                          <td name="td_amount_vat_forfair_label"><strong>BTW teruggave <span t-field="doc.vat_amount"/> BTW - Forfaitbedrag <span t-field="doc.forfair_vat"/> =)</strong></td>
                          <td name="td_amount_vat_forfair" class="text-right">
                            <span t-field="doc.vat_reduction"/>
                          </td>
                      </tr>

                      <tr>
                          <!-- Netto investering -->
                          <td name="td_amount_netto_netto_label"><strong>Netto investering</strong></td>
                          <td name="td_amount_netto_netto" class="text-right">
                            <span t-field="doc.net_investment"/>
                          </td>
                      </tr>
                      
                    </t>

                </table>
              
              <div class="row mt-4 mb-4">
                  <div class="col-12 text-left">
                      <span >Terugverdientijd conform <span t-field="doc.energycost"/> per kWh is <span t-field="doc.roi_years"/> jaar</span>
                  </div>
              </div>

              <t t-if="doc.vat_reduction_type == 'yes'">
                <div class="row mt-4 mb-4">
                    <div class="col-12 text-left">
                        <span t-if="doc.company_id.vat_disclamer" t-raw="doc.company_id.vat_disclamer"/>
                    </div>
                </div>
              </t>

            </div>
          </div>
        </div>
      </div>

      
          <br/>
            <div style="page-break-inside:avoid;">
              <!-- Signature part -->
                <div class="row mt-4 mb-4">
                    <div class="col-8">Met vriendelijke groet,
                    </div>
                    <div class="col-4">Voor akkoord: </div>
                </div>
                <br/>
                <br/>

                <div class="row mt-4 mb-4">
                    <div class="col-8">
                    </div>
                    <div class="col-4"><span t-field="doc.partner_id.city"/> d.d...............</div>
                </div>

				<div class="row mt-4 mb-4">
					<div class="col-8">Adviesteam <span t-field="doc.company_id.name"/>
					</div>
					<!--TODO Alignment -->
					<div class="col-4">
						<t t-if="doc.contact_person">
							<t t-if="doc.contact_person.title"><span t-field="doc.contact_person.title"/> <span t-field="doc.contact_person.name"/></t>
					    	<t t-if="not doc.contact_person.title"><span t-field="doc.contact_person.name"/></t>
						</t>
						<t t-if="not doc.contact_person">
							<t t-if="doc.partner_id.title"><span t-field="doc.partner_id.title"/> <span t-field="doc.partner_id.name"/></t>
					    	<t t-if="not doc.partner_id.title"><span t-field="doc.partner_id.name"/></t>
						</t>
					</div>
				</div>
            </div>
        </div>

        <div style="page-break-after:always;"/>
        <!-- OPTION PRODUCT -->
        <div style="page-break-inside:avoid;" t-if="doc.sale_order_option_ids">
          <div>
          <div class="row mt-4 mb-4">
              <div class="col-12 text-left pebble_header">
                  <span ><b>Extra Opties:</b></span>
              </div>
          </div>
          <div style="border-bottom: 1px solid grey;"/>

          <!-- display every sale order option line-->
          <t t-set="total_amount" t-value="0"/>
          <t t-foreach="doc.sale_order_option_ids" t-as="option">
              <!-- display the name, qty and uom-->
            <div class="row mt-4 mb-4">
              <div class="col-8 text-left">
                <span style="font-size:22px"> ☐ </span>
                <span t-field="option.name"/>
                <span t-if="option.product_id.html_product_details" t-raw="option.product_id.html_product_details"/>
                <span t-if="option.product_id.html_product_details_2" t-raw="option.product_id.html_product_details_2"/>
              </div>
              <div class="col-2 text-right">
                  <span t-field="option.quantity" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 0}"/>
                  <span t-field="option.uom_id"/>
              </div>
              <t t-set="total_amount" t-value="option.quantity * option.price_unit "/>
              <div class="col-2 text-right">
                  <span t-esc="total_amount" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
              </div>
            </div>
          </t>
        </div>
        <br/>

        <div style="page-break-inside:avoid;">
          <div class="row mt-4 mb-4">
            <div class="col-12">
              <span t-if="doc.company_id.extra_option_text" t-raw="doc.company_id.extra_option_text"/>
              <br/>
            </div>
          </div>
        </div>

        <div style="page-break-inside:avoid;">
          <!-- Signature part -->
            <div class="row mt-4 mb-4">
                <div class="col-8">Met vriendelijke groet,
                </div>
                <div class="col-4">Voor akkoord: </div>
            </div>
            <br/>
            <br/>

            <div class="row mt-4 mb-4">
                <div class="col-8">
                </div>
                <div class="col-4"><span t-field="doc.partner_id.city"/> d.d...............</div>
            </div>

            <div class="row mt-4 mb-4">
              <div class="col-8">Adviesteam <span t-field="doc.company_id.name"/>
              </div>
              <!--TODO Alignment -->
              <div class="col-4">
                <t t-if="doc.contact_person">
                  <t t-if="doc.contact_person.title"><span t-field="doc.contact_person.title"/> <span t-field="doc.contact_person.name"/></t>
                    <t t-if="not doc.contact_person.title"><span t-field="doc.contact_person.name"/></t>
                </t>
                <t t-if="not doc.contact_person">
                  <t t-if="doc.partner_id.title"><span t-field="doc.partner_id.title"/> <span t-field="doc.partner_id.name"/></t>
                    <t t-if="not doc.partner_id.title"><span t-field="doc.partner_id.name"/></t>
                </t>
              </div>
            </div>
        </div>
      </div>
  </t>
</template>

<template id="report_saleorder_noprice_document_solar">
  <t t-call="web.external_layout">
    <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
    <t t-set="address">
      <div t-field="doc.contact_person" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: True}"/>
      <p t-if="doc.partner_id.vat"><t t-esc="doc.company_id.country_id.vat_label or 'Tax ID'"/>: <span t-field="doc.partner_id.vat"/></p>
    </t>
    <t t-if="doc.partner_shipping_id == doc.partner_invoice_id and doc.partner_invoice_id != doc.partner_id or doc.partner_shipping_id != doc.partner_invoice_id">
      <t t-set="information_block">
        <strong t-if="doc.partner_shipping_id == doc.partner_invoice_id">Factuur en verzendadres:</strong>
        <strong t-if="doc.partner_shipping_id != doc.partner_invoice_id">Factuur adres:</strong>
        <div t-field="doc.partner_invoice_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
        <t t-if="doc.partner_shipping_id != doc.partner_invoice_id">
            <strong>Verzend adres:</strong>
            <div t-field="doc.partner_shipping_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
        </t>
      </t>
    </t>
    <div class="page">
      <div class="oe_structure"/>

      <h2 class="mt-8">
        <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
            <span t-if="doc.state not in ['draft','sent']">Verkooporder # </span>
            <span t-if="doc.state in ['draft','sent']">Offerte # </span>
        </t>
        <t t-if="env.context.get('proforma', False) or is_pro_forma">
            <span>Pro-Forma factuur # </span>
        </t>
        <span t-field="doc.name"/>
      </h2>

      <div class="row mt-8 mb-8" id="informations">
        <div t-if="doc.client_order_ref"  class="col-auto col-3 mw-100 mb-2" name="informations_reference">
          <strong>Uw referentie:</strong>
          <p class="m-0" t-field="doc.client_order_ref"/>
        </div>
        <div t-if="doc.date_order and doc.state not in ['draft','sent']"  class="col-auto col-3 mw-100 mb-2" name="informations_date">
          <strong>Order datum:</strong>
          <p class="m-0" t-field="doc.date_order"/>
        </div>
        <div t-if="doc.date_order and doc.state in ['draft','sent']"  class="col-auto col-3 mw-100 mb-2" >
          <strong>Offere datum:</strong>
          <p class="m-0" t-field="doc.date_order" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
        </div>
        <div t-if="doc.validity_date and doc.state in ['draft', 'sent']"  class="col-auto col-3 mw-100 mb-2"  name="expiration_date">
          <strong>Vervaldatum:</strong>
          <p class="m-0" t-field="doc.validity_date"/>
        </div>
        <div t-if="doc.user_id.name"  class="col-auto col-3 mw-100 mb-2">
          <strong>Verkoper:</strong>
          <p class="m-0" t-field="doc.user_id"/>
        </div>
      </div>

      <!-- Is there a discount on at least one line? -->
      <t t-set="display_discount" t-value="any([l.discount for l in doc.order_line])"/>

      <table class="table table-sm o_main_table">
        <thead>
          <tr>
            <th name="th_description" class="text-left">Omschrijving</th>
            <th name="th_quantity" class="text-right">Aantal</th>
            <th name="th_taxes" class="text-right">BTW</th>
          </tr>
        </thead>
          <tbody class="sale_tbody"> 
            <t t-foreach="doc.order_line" t-as="line">
              <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                <t t-if="not line.display_type">
                    <td name="td_name"><span t-field="line.name"/></td>
                    <td name="td_quantity" class="text-right">
                      <span t-field="line.product_uom_qty"/>
                      <span t-field="line.product_uom" groups="uom.group_uom"/>
                    </td>
                    <td name="td_taxes" class="text-right">
                      <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                    </td>
                  </t>
                <t t-if="line.display_type == 'line_section'">
                  <td name="td_section_line" colspan="99">
                      <span t-field="line.name"/>
                  </td>
                </t>
                <t t-if="line.display_type == 'line_note'">
                  <td name="td_note_line" colspan="99">
                      <span t-field="line.name"/>
                  </td>
                </t>
              </tr>

              <t t-if="current_section and (line_last or doc.order_line[line_index+1].display_type == 'line_section')">
                <tr class="is-subtotal text-right">
                  <td name="td_section_subtotal" colspan="99">
                    <strong class="mr16">Subtotaal</strong>
                    <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
                  </td>
                </tr>
              </t>
            </t>
        </tbody>
      </table>

      <div class="clearfix" name="so_total_summary">
        <div id="total" class="row" name="total">
          <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
            <table class="table table-sm">
              <tr class="border-black o_subtotal" style="">
                <td name="td_amount_untaxed_label"><strong>Subtotaal</strong></td>
                <td name="td_amount_untaxed" class="text-right">
                    <span t-field="doc.amount_untaxed"/>
                </td>
              </tr>
              <t t-foreach="doc.amount_by_group" t-as="amount_by_group">
                <tr style="">
                  <t t-if="amount_by_group[5] == 1 and doc.amount_untaxed == amount_by_group[2]">
                    <td name="td_amount_by_group_label_3">
                        <span t-esc="amount_by_group[0]"/>
                        <span>&amp;nbsp;<span>op</span>&amp;nbsp;<t t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></span>
                    </td>
                    <td name="td_amount_by_group_3" class="text-right o_price_total">
                        <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
                    </td>
                  </t>
                  <t t-else="">
                    <td name="td_amount_by_group_label">
                      <span t-esc="amount_by_group[0]"/>
                    </td>
                    <td name="td_amount_by_group" class="text-right o_price_total">
                      <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
                    </td>
                  </t>
                </tr>
              </t>
              <tr class="border-black o_total">
                <td name="td_amount_total_label"><strong>Totaal</strong></td>
                <td name="td_amount_total" class="text-right">
                  <span t-field="doc.amount_total"/>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <div t-if="doc.signature" class="mt-4 ml-4 mr-4" name="signature">
        <div class="offset-8">
          <strong>Handtekening</strong>
        </div>
        <div class="offset-8">
          <img t-att-src="image_data_uri(doc.signature)" style="max-height: 4cm; max-width: 8cm;"/>
        </div>
        <div class="offset-8 text-center">
          <p t-field="doc.signed_by"/>
        </div>
      </div>

      <div class="oe_structure"/>

      <p t-field="doc.note"/>
      <p t-if="doc.payment_term_id.note">
          <span t-field="doc.payment_term_id.note"/>
      </p>
      <p id="fiscal_position_remark" t-if="doc.fiscal_position_id and doc.fiscal_position_id.sudo().note">
        <strong>Fiscale positie notities:</strong>
        <span t-field="doc.fiscal_position_id.sudo().note"/>
      </p>
    </div>
  </t>
</template>

<template id="sale.report_saleorder">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="doc">
            <t t-if="doc.order_type == 'default'">
                <t t-call="sale.report_saleorder_document" t-lang="doc.partner_id.lang"/>
            </t>
            <t t-if="doc.order_type == 'b2c_solar'">
                <t t-call="solar_extended.report_saleorder_document_solar" t-lang="doc.partner_id.lang"/>
            </t>
            <t t-if="doc.order_type == 'default_no_price'">
                <t t-call="solar_extended.report_saleorder_noprice_document_solar" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </t>
</template>


</odoo>